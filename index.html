<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cute Shop</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- CUTE Y2K AESTHETIC --- */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: linear-gradient(180deg, #ffd1dc 0%, #ffe4e1 100%); 
            background-attachment: fixed;
            font-family: 'Trebuchet MS', 'Lucida Sans Unicode', sans-serif;
            padding-bottom: 90px; 
            color: #5d3a5d;
        }

        /* --- TOAST NOTIFICATION --- */
        #toast {
            visibility: hidden; min-width: 260px; background-color: rgba(255, 255, 255, 0.98);
            color: #d81b60; text-align: center; border-radius: 20px; padding: 20px;
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 2000; box-shadow: 0 10px 30px rgba(216, 27, 96, 0.4);
            font-weight: bold; font-size: 16px; border: 3px solid #ffb7c5;
            opacity: 0; transition: opacity 0.3s;
        }
        #toast.show { visibility: visible; opacity: 1; }

        /* --- TOP BAR --- */
        .top-bar {
            position: sticky; top: 0; 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            padding: 15px; border-bottom: 1px solid #ffb7c5; 
            display: flex; align-items: center; gap: 10px; z-index: 100;
        }
        .search-input {
            width: 100%; padding: 10px 10px 10px 35px; border-radius: 20px; 
            border: 2px solid #ffb7c5; background: #fff0f5;
            color: #d81b60; font-weight: bold; outline: none;
        }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #ff69b4; }

        /* --- CATEGORY BAR --- */
        .filter-bar {
            position: sticky; top: 68px; background: rgba(255,255,255,0.9); backdrop-filter: blur(5px);
            padding: 10px 15px; border-bottom: 2px solid #ffb7c5;
            display: flex; gap: 10px; align-items: center; z-index: 90;
            overflow-x: auto; white-space: nowrap; -ms-overflow-style: none; scrollbar-width: none;
        }
        .filter-bar::-webkit-scrollbar { display: none; }
        .cat-btn {
            padding: 6px 15px; border-radius: 20px; border: 1px solid #ff69b4; background: #fff;
            color: #ff69b4; font-size: 13px; font-weight: bold; cursor: pointer; flex-shrink: 0; transition: all 0.2s;
        }
        .cat-btn.active { background: #ff69b4; color: #fff; }
        .sort-wrapper { position: relative; margin-left: auto; border-left: 2px solid #ffd1dc; padding-left: 10px; }
        .sort-select { appearance: none; border: none; background: transparent; font-weight: bold; color: #d81b60; font-size: 13px; cursor: pointer; padding-right: 15px; }
        .sort-icon { position: absolute; right: 0; top: 2px; color: #d81b60; pointer-events: none; font-size: 10px; }

        /* --- PRODUCT GRID --- */
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .product-card {
            position: relative; border-radius: 18px; overflow: hidden;
            background: rgba(255,255,255,0.8); border: 2px solid #fff;
            box-shadow: 0 4px 10px rgba(255, 182, 193, 0.4);
            transition: transform 0.2s; cursor: pointer;
        }
        .product-card:active { transform: scale(0.98); }
        .card-like-badge {
            position: absolute; top: 8px; right: 8px; z-index: 5;
            display: flex; align-items: center; gap: 4px;
            background: rgba(255,255,255,0.85); padding: 5px 8px; border-radius: 15px;
            backdrop-filter: blur(4px); border: 1px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer;
        }
        .card-heart {
            width: 18px; height: 18px; background-size: contain; background-repeat: no-repeat; background-position: center;
            filter: grayscale(100%) opacity(0.5); transition: transform 0.2s;
        }
        .card-heart.active { filter: grayscale(0%) opacity(1); transform: scale(1.2); }
        .card-like-count { font-size: 12px; font-weight: bold; color: #d81b60; font-family: 'Courier New', monospace; }
        .product-image { width: 100%; height: 180px; object-fit: cover; background: #ffe4e1; border-bottom: 2px solid #fff; }
        .product-info { padding: 12px; text-align: center; }
        .product-title { font-size: 14px; font-weight: bold; color: #d81b60; margin-bottom: 4px; }
        .brand { font-size: 11px; color: #9c27b0; text-transform: uppercase; letter-spacing: 1px; }
        .price { font-weight: 900; color: #d81b60; font-size: 16px; margin-top: 5px; }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            border-top: 2px solid #ffb7c5;
            display: flex; justify-content: space-around; align-items: center; 
            padding: 10px; height: 80px; z-index: 200;
            box-shadow: 0 -5px 20px rgba(255, 182, 193, 0.2);
            border-radius: 20px 20px 0 0;
        }
        .nav-btn { 
            display: flex; flex-direction: column; align-items: center; 
            text-decoration: none; color: #ff69b4; font-size: 11px; font-weight: bold;
            opacity: 0.6; transition: all 0.2s; cursor: pointer;
        }
        .nav-btn.active { opacity: 1; transform: translateY(-3px); }
        .nav-btn i { 
            font-size: 26px; margin-bottom: 5px; 
            background: -webkit-linear-gradient(#ff69b4, #ff1493); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 3px 3px rgba(255,105,180,0.3));
        }

        /* --- SHARED VIEW STYLES --- */
        .full-page-view {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(180deg, #ffd1dc 0%, #ffe4e1 100%); 
            z-index: 500; overflow-y: auto; padding-bottom: 100px;
        }
        .app-header {
            position: sticky; top: 0; width: 100%; padding: 20px;
            display: flex; justify-content: space-between; align-items: center; z-index: 10;
        }
        .icon-btn { 
            background: rgba(255,255,255,0.5); border: 2px solid #fff;
            color: #ff1493; border-radius: 50%; width: 45px; height: 45px; 
            display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(5px); box-shadow: 0 4px 10px rgba(255,105,180,0.2);
            text-decoration: none; font-size: 18px;
        }

        /* --- PROFILE VIEW --- */
        .profile-header { display: flex; flex-direction: column; align-items: center; padding: 40px 20px; }
        .profile-pic {
            width: 100px; height: 100px; border-radius: 50%; background: #fff;
            border: 4px solid #ffb7c5; margin-bottom: 15px;
            display: flex; align-items: center; justify-content: center; font-size: 40px; color: #ff69b4;
            box-shadow: 0 5px 15px rgba(216, 27, 96, 0.2);
        }
        .profile-name { font-size: 24px; font-weight: 900; color: #d81b60; margin-bottom: 5px; }
        .profile-sub { font-size: 14px; color: #9c27b0; margin-bottom: 30px; }

        .profile-menu { margin: 0 20px; background: rgba(255,255,255,0.7); border-radius: 20px; border: 2px solid #fff; overflow: hidden; }
        .menu-item {
            padding: 20px; border-bottom: 1px solid #ffe4e1; display: flex; align-items: center; justify-content: space-between;
            color: #5d3a5d; font-weight: bold; cursor: pointer; transition: background 0.2s;
        }
        .menu-item:last-child { border-bottom: none; }
        .menu-item:active { background: #fff0f5; }
        .menu-left { display: flex; align-items: center; gap: 15px; }
        .menu-left i { width: 25px; text-align: center; color: #ff69b4; font-size: 18px; }

        /* --- PRODUCT PAGE --- */
        .image-container { position: relative; width: 100%; height: 420px; background: #fff0f5; border-bottom: 3px solid #fff; }
        .carousel { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; width: 100%; height: 100%; }
        .carousel img { min-width: 100%; height: 100%; object-fit: cover; scroll-snap-align: center; }
        .floating-heart-main {
            position: absolute; bottom: 30px; right: 30px;
            width: 60px; height: 60px; background-size: contain; background-repeat: no-repeat; background-position: center;
            filter: grayscale(100%) opacity(0.6) drop-shadow(0 5px 5px rgba(0,0,0,0.1)); 
            transition: all 0.3s; cursor: pointer; z-index: 20;
        }
        .floating-heart-main.active { filter: grayscale(0%) opacity(1); transform: scale(1.1); }
        .detail-section { padding: 25px; margin: 15px; background: rgba(255,255,255,0.6); border-radius: 20px; border: 2px solid #fff; }
        .title-row { display: flex; justify-content: space-between; align-items: start; }
        .detail-title { font-size: 22px; color: #d81b60; font-weight: 900; margin-bottom: 5px; flex-grow: 1; }
        .detail-meta { font-size: 13px; color: #9c27b0; margin-bottom: 10px; font-weight: bold; }
        .detail-price { font-size: 28px; font-weight: 900; color: #d81b60; }
        .buyer-protection {
            font-size: 13px; color: #d81b60; background: #fff0f5; border: 1px solid #ffb7c5;
            padding: 10px; border-radius: 12px; margin-top: 12px; display: inline-flex; align-items: center; gap: 8px; font-weight: bold;
        }
        .action-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; padding: 15px 20px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-top: 2px solid #ffb7c5; 
            display: flex; gap: 15px; z-index: 600; border-radius: 25px 25px 0 0;
        }
        .btn-cute {
            flex: 1; padding: 15px; border-radius: 30px; font-weight: 900; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; font-size: 16px;
            box-shadow: 0 5px 10px rgba(255, 105, 180, 0.3), inset 0 2px 0 rgba(255,255,255,0.5);
            border: 2px solid #fff; transition: transform 0.1s;
        }
        .btn-offer { background: linear-gradient(to bottom, #fff0f5 0%, #ffc1e3 100%); color: #d81b60; }
        .btn-buy { background: linear-gradient(to bottom, #ff69b4 0%, #ff1493 100%); color: #fff; text-shadow: 0 2px 2px rgba(0,0,0,0.2); }
        .like-count-text { font-size: 14px; color: #d81b60; display: flex; align-items: center; gap: 6px; font-weight: bold; background: #fff; padding: 5px 10px; border-radius: 20px; }
        .like-count-text i { color: #ff1493; }

    </style>
</head>
<body>

    <div id="toast"><i class="fas fa-check-circle"></i><br>Copied to clipboard! ❤️</div>

    <div id="main-view">
        <nav class="top-bar">
            <div style="position:relative; flex-grow:1;">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="search-box" placeholder="Search..." onkeyup="handleSearch()">
            </div>
        </nav>

        <div class="filter-bar">
            <button class="cat-btn active" onclick="filterCategory('All', this)">All</button>
            <button class="cat-btn" onclick="filterCategory('Womans', this)">Womans</button>
            <button class="cat-btn" onclick="filterCategory('Kids', this)">Kids</button>
            <button class="cat-btn" onclick="filterCategory('T-Shirts', this)">T-Shirts</button>
            <button class="cat-btn" onclick="filterCategory('Hoodies', this)">Hoodies</button>
            
            <div class="sort-wrapper">
                <i class="fas fa-sort sort-icon"></i>
                <select class="sort-select" onchange="handleSort(this.value)">
                    <option value="newest">Newest</option>
                    <option value="oldest">Oldest</option>
                    <option value="price-low">Price: Low to High</option>
                    <option value="price-high">Price: High to Low</option>
                </select>
            </div>
        </div>

        <main class="product-grid" id="shop-container">
             <div style="padding:20px; grid-column:span 2; text-align:center; color:#d81b60; font-weight:bold;">Loading Shop... ✨</div>
        </main>

        <nav class="bottom-nav">
            <div class="nav-btn active" onclick="showMain()"><i class="fas fa-th-large"></i>More</div>
            <div class="nav-btn" onclick="alert('Orders page coming soon!')"><i class="fas fa-shopping-bag"></i>Orders</div>
            <div class="nav-btn" onclick="showProfile()"><i class="fas fa-user-circle"></i>Profile</div>
        </nav>
    </div>

    <div id="profile-view" class="full-page-view">
        <div class="profile-header">
            <div class="profile-pic"><i class="fas fa-user"></i></div>
            <div class="profile-name">Guest User</div>
            <div class="profile-sub">Welcome back! ✨</div>
        </div>
        <div class="profile-menu">
            <div class="menu-item" onclick="showFavorites()">
                <div class="menu-left"><i class="fas fa-heart"></i> My Favorites</div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ccc;"></i>
            </div>
            <div class="menu-item" onclick="alert('Orders coming soon!')">
                <div class="menu-left"><i class="fas fa-shopping-bag"></i> My Orders</div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ccc;"></i>
            </div>
            <div class="menu-item" onclick="showMain()">
                <div class="menu-left"><i class="fas fa-home"></i> Back to Shop</div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ccc;"></i>
            </div>
        </div>
    </div>

    <div id="favorites-view" class="full-page-view">
        <div class="app-header">
            <a href="#" onclick="showProfile()" class="icon-btn"><i class="fas fa-arrow-left"></i></a>
            <div style="font-weight:bold; color:#d81b60; font-size:18px;">My Favorites</div>
            <div style="width:45px;"></div> </div>
        <div class="product-grid" id="favorites-container"></div>
    </div>

    <div id="product-page" class="full-page-view">
        <div class="app-header">
            <a href="#" onclick="closeProduct()" class="icon-btn"><i class="fas fa-arrow-left"></i></a>
            <a href="#" onclick="shareProduct(event)" class="icon-btn"><i class="fas fa-link"></i></a>
        </div>
        <div class="image-container">
            <div class="carousel" id="detail-images"></div>
            <div class="floating-heart-main" id="like-trigger-main" onclick="toggleLikeFromDetail()"></div>
        </div>
        <div class="detail-section">
            <div class="title-row">
                <div class="detail-title" id="detail-name">Product Name</div>
                <div class="like-count-text"><i class="fas fa-heart"></i><span id="like-counter">0</span></div>
            </div>
            <div class="detail-meta" id="detail-meta">Brand • Category</div>
            <div class="detail-price" id="detail-price">$0.00</div>
            <div class="buyer-protection"><i class="fas fa-shield-alt" style="font-size:18px;"></i> Buyer Protection included</div>
        </div>
        <div class="detail-section"><p style="font-size:16px; line-height:1.6; color:#5d3a5d;" id="detail-desc">Description...</p></div>
        <div class="action-bar">
            <button class="btn-cute btn-offer">Make offer</button>
            <button class="btn-cute btn-buy" onclick="alert('Opening checkout...')">Buy now</button>
        </div>
    </div>

    <script>
        // CONFIG
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQxSaXfeWcwBFpXFfbJ4lU25jKhR4ORNTbtQphKOUK7YL4JewJ2NzsS6UNf0V89UnzTufpcreBCJUJo/pub?output=csv";
        const heartImageUrl = "https://www.freepnglogos.com/uploads/heart-png/heart-icon-small-flat-4.png"; 

        let allProducts = [];
        let currentCategory = 'All';
        let currentSort = 'newest';
        
        // This variable tracks where you came from!
        let activeParentView = 'main'; 

        const container = document.getElementById('shop-container');
        const mainView = document.getElementById('main-view');
        const productPage = document.getElementById('product-page');
        const profileView = document.getElementById('profile-view');
        const favoritesView = document.getElementById('favorites-view');
        
        const mainHeart = document.getElementById('like-trigger-main');
        if(heartImageUrl) mainHeart.style.backgroundImage = `url('${heartImageUrl}')`;

        async function loadProducts() {
            try {
                const response = await fetch(sheetUrl);
                const data = await response.text();
                allProducts = csvToJson(data);
                applyFilters(); 
                checkHash();
            } catch (error) { console.error(error); }
        }

        // --- NAVIGATION ---
        function showMain() {
            activeParentView = 'main'; // Remember we are on Main
            mainView.style.display = 'block';
            profileView.style.display = 'none';
            favoritesView.style.display = 'none';
            productPage.style.display = 'none';
            applyFilters(); 
        }

        function showProfile() {
            mainView.style.display = 'none';
            profileView.style.display = 'block';
            favoritesView.style.display = 'none';
            productPage.style.display = 'none';
        }

        function showFavorites() {
            activeParentView = 'favorites'; // Remember we are on Favorites
            profileView.style.display = 'none';
            favoritesView.style.display = 'block';
            
            const favContainer = document.getElementById('favorites-container');
            const favProducts = allProducts.filter(p => localStorage.getItem('liked_item_' + p.id));
            
            if(favProducts.length === 0) {
                favContainer.innerHTML = `<div style="grid-column:span 2; text-align:center; padding:40px; color:#d81b60;">No favorites yet! <br> Go heart some items ❤️</div>`;
            } else {
                let html = '';
                favProducts.forEach(p => html += createCardHtml(p));
                favContainer.innerHTML = html;
                if(heartImageUrl) document.querySelectorAll('.card-heart').forEach(el => el.style.backgroundImage = `url('${heartImageUrl}')`);
            }
        }

        // --- SHARE + TOAST ---
        function shareProduct(event) {
            if(event) event.preventDefault();
            navigator.clipboard.writeText(window.location.href).then(() => {
                const toast = document.getElementById("toast");
                toast.className = "show";
                setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3500);
            }).catch(err => alert("Could not copy link :("));
        }

        // --- FILTERING ---
        function filterCategory(cat, btn) {
            currentCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            applyFilters();
        }
        function handleSort(sortValue) { currentSort = sortValue; applyFilters(); }
        function handleSearch() { applyFilters(); }

        function applyFilters() {
            let filtered = [...allProducts];
            const query = document.getElementById('search-box').value.toLowerCase();
            if(query) filtered = filtered.filter(p => p.name.toLowerCase().includes(query) || p.brand.toLowerCase().includes(query));
            if(currentCategory !== 'All') filtered = filtered.filter(p => p.category.toLowerCase().includes(currentCategory.toLowerCase()) || p.name.toLowerCase().includes(currentCategory.toLowerCase()));
            
            if(currentSort === 'newest') filtered.sort((a, b) => b.id - a.id);
            else if (currentSort === 'oldest') filtered.sort((a, b) => a.id - b.id);
            else if (currentSort === 'price-low') filtered.sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
            else if (currentSort === 'price-high') filtered.sort((a, b) => parseFloat(b.price) - parseFloat(a.price));
            
            renderMainGrid(filtered);
        }

        // --- RENDERING ---
        function csvToJson(csv) {
            const lines = csv.split('\n');
            const result = [];
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i]) continue;
                const row = lines[i].split(','); 
                const cleanImage = (url) => {
                    if (!url) return "";
                    let cleanUrl = url.trim();
                    if (cleanUrl.includes('drive.google.com')) {
                        const idMatch = cleanUrl.match(/[-\w]{25,}/);
                        if (idMatch) return `https://drive.google.com/thumbnail?id=${idMatch[0]}&sz=w1000`;
                    }
                    return cleanUrl;
                };
                result.push({
                    id: i,
                    name: row[0] || "Item",
                    price: (row[1] || "0").replace('$', '').trim(),
                    brand: row[2] || "Brand",
                    image: cleanImage(row[3]), 
                    category: row[4] || "Misc",
                    description: row[5] || "No description.",
                    moreImages: row[6] ? row[6].split(';').map(cleanImage) : [] 
                });
            }
            return result.reverse();
        }

        function createCardHtml(p) {
            const isLiked = localStorage.getItem('liked_item_' + p.id);
            const activeClass = isLiked ? 'active' : '';
            const fakeCount = Math.floor(p.id * 123 % 50) + 10 + (isLiked ? 1 : 0);
            return `
                <div class="product-card" onclick="openProduct(${p.id})">
                    <div class="card-like-badge" onclick="toggleLikeFromCard(event, ${p.id})">
                        <div class="card-heart ${activeClass}" id="card-heart-${p.id}"></div>
                        <span class="card-like-count" id="card-count-${p.id}">${fakeCount}</span>
                    </div>
                    <img src="${p.image}" class="product-image" onerror="this.src='https://via.placeholder.com/300/ffc1e3/d81b60?text=Cute+Item'">
                    <div class="product-info">
                        <div class="product-title">${p.name}</div>
                        <div class="brand">${p.brand}</div>
                        <div class="price">$${p.price}</div>
                    </div>
                </div>
            `;
        }

        function renderMainGrid(products) {
            if(products.length === 0) {
                container.innerHTML = `<div style="grid-column:span 2; text-align:center; padding:20px;">No items found :(</div>`;
                return;
            }
            let html = '';
            products.forEach(p => html += createCardHtml(p));
            container.innerHTML = html;
            if(heartImageUrl) document.querySelectorAll('.card-heart').forEach(el => el.style.backgroundImage = `url('${heartImageUrl}')`);
        }

        function openProduct(id) {
            const product = allProducts.find(p => p.id == id);
            if (!product) return;
            window.location.hash = `item-${id}`;
            document.getElementById('detail-name').innerText = product.name;
            document.getElementById('detail-price').innerText = '$' + product.price;
            document.getElementById('detail-desc').innerText = product.description;
            document.getElementById('detail-meta').innerText = `${product.brand} • ${product.category}`;

            let imagesHtml = `<img src="${product.image}">`;
            if (product.moreImages.length > 0) {
                product.moreImages.forEach(img => { if(img) imagesHtml += `<img src="${img}">`; });
            }
            document.getElementById('detail-images').innerHTML = imagesHtml;
            updateDetailLikeState(id);
            
            // Hide all other views
            mainView.style.display = 'none';
            profileView.style.display = 'none';
            favoritesView.style.display = 'none';
            productPage.style.display = 'block';
            window.scrollTo(0,0);
        }

        function closeProduct() {
            window.location.hash = '';
            productPage.style.display = 'none';
            
            // SMART RETURN: Go back to where you came from!
            if(activeParentView === 'favorites') {
                showFavorites(); // Go back to Favs list (and update it)
            } else {
                showMain(); // Go back to Home
            }
        }

        // --- LIKE LOGIC ---
        function getFakeCount(id) { return Math.floor(id * 123 % 50) + 10; }

        function updateDetailLikeState(id) {
            const btn = document.getElementById('like-trigger-main');
            const counter = document.getElementById('like-counter');
            const baseCount = getFakeCount(id);
            const isLiked = localStorage.getItem('liked_item_' + id);
            if(isLiked) { btn.classList.add('active'); counter.innerText = baseCount + 1; } 
            else { btn.classList.remove('active'); counter.innerText = baseCount; }
        }

        function toggleLikeFromDetail() {
            const id = window.location.hash.replace('#item-','');
            const btn = document.getElementById('like-trigger-main');
            const isLiked = btn.classList.contains('active');
            if(isLiked) { btn.classList.remove('active'); localStorage.removeItem('liked_item_' + id); } 
            else { btn.classList.add('active'); localStorage.setItem('liked_item_' + id, 'yes'); }
            updateDetailLikeState(id);
        }

        function toggleLikeFromCard(event, id) {
            event.stopPropagation();
            const heart = document.getElementById(`card-heart-${id}`);
            const targetHeart = event.target.closest('.card-like-badge').querySelector('.card-heart');
            const targetCount = event.target.closest('.card-like-badge').querySelector('.card-like-count');
            
            const isLiked = targetHeart.classList.contains('active');
            const baseCount = getFakeCount(id);

            if(isLiked) { 
                targetHeart.classList.remove('active'); 
                localStorage.removeItem('liked_item_' + id); 
                targetCount.innerText = baseCount;
                // If in Favs view, we could remove it immediately, but leaving it until refresh is often better UX
            } else { 
                targetHeart.classList.add('active'); 
                localStorage.setItem('liked_item_' + id, 'yes'); 
                targetCount.innerText = baseCount + 1;
            }
        }

        function checkHash() {
            const hash = window.location.hash;
            if (hash.startsWith('#item-')) { openProduct(hash.replace('#item-', '')); } 
            else { 
                // Default to main view if no hash and nothing else is open
                if(productPage.style.display !== 'block' && profileView.style.display !== 'block' && favoritesView.style.display !== 'block') {
                    showMain();
                }
            }
        }
        window.onhashchange = checkHash;

        loadProducts();
    </script>
</body>
</html>
