<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cute Shop</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- CUTE Y2K AESTHETIC --- */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body { 
            /* Soft Pink to Pastel Peach Gradient */
            background: linear-gradient(180deg, #ffd1dc 0%, #ffe4e1 100%); 
            background-attachment: fixed;
            font-family: 'Trebuchet MS', 'Lucida Sans Unicode', sans-serif;
            padding-bottom: 90px; 
            color: #5d3a5d; /* Deep purple/brown text */
        }

        /* --- TOP BAR --- */
        .top-bar {
            position: sticky; top: 0; 
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            padding: 15px; border-bottom: 2px solid #ffb7c5; 
            display: flex; align-items: center; gap: 10px; z-index: 100;
        }
        .search-input {
            width: 100%; padding: 10px 10px 10px 35px; border-radius: 20px; 
            border: 2px solid #ffb7c5; background: #fff0f5;
            color: #d81b60; font-weight: bold; outline: none;
        }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #ff69b4; }

        /* --- PRODUCT GRID --- */
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        
        .product-card {
            position: relative;
            border-radius: 18px; overflow: hidden;
            background: rgba(255,255,255,0.8);
            border: 2px solid #fff;
            box-shadow: 0 4px 10px rgba(255, 182, 193, 0.4);
            transition: transform 0.2s; cursor: pointer;
        }
        .product-card:active { transform: scale(0.98); }
        
        /* Mini Heart on Home Page - Top Right */
        .card-heart {
            position: absolute; top: 8px; right: 8px; z-index: 5;
            width: 25px; height: 25px;
            background-size: contain; background-repeat: no-repeat; background-position: center;
            filter: grayscale(100%) opacity(0.5);
            transition: transform 0.2s;
        }
        /* When active, it pops and shows full color */
        .card-heart.active { filter: grayscale(0%) opacity(1); transform: scale(1.2); }

        .product-image { 
            width: 100%; height: 180px; object-fit: cover; 
            background: #ffe4e1; border-bottom: 2px solid #fff;
        }
        .product-info { padding: 12px; text-align: center; }
        .product-title { font-size: 14px; font-weight: bold; color: #d81b60; margin-bottom: 4px; }
        .brand { font-size: 11px; color: #9c27b0; text-transform: uppercase; letter-spacing: 1px; }
        .price { font-weight: 900; color: #d81b60; font-size: 16px; margin-top: 5px; }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            border-top: 2px solid #ffb7c5;
            display: flex; justify-content: space-around; align-items: center; 
            padding: 10px; height: 80px; z-index: 200;
            box-shadow: 0 -5px 20px rgba(255, 182, 193, 0.2);
            border-radius: 20px 20px 0 0;
        }
        .nav-btn { 
            display: flex; flex-direction: column; align-items: center; 
            text-decoration: none; color: #ff69b4; font-size: 11px; font-weight: bold;
            opacity: 0.6; transition: all 0.2s;
        }
        .nav-btn.active, .nav-btn:active { opacity: 1; transform: translateY(-3px); }
        .nav-btn i { 
            font-size: 26px; margin-bottom: 5px; 
            background: -webkit-linear-gradient(#ff69b4, #ff1493); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 3px 3px rgba(255,105,180,0.3));
        }

        /* --- PRODUCT PAGE (Pink Theme) --- */
        #product-page {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(180deg, #ffd1dc 0%, #ffe4e1 100%); 
            z-index: 500; overflow-y: auto; padding-bottom: 100px;
        }
        
        .app-header {
            position: absolute; top: 0; width: 100%; padding: 20px;
            display: flex; justify-content: space-between; z-index: 10;
        }
        .icon-btn { 
            background: rgba(255,255,255,0.5); border: 2px solid #fff;
            color: #ff1493; border-radius: 50%; width: 45px; height: 45px; 
            display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(5px); box-shadow: 0 4px 10px rgba(255,105,180,0.2);
        }

        .image-container { position: relative; width: 100%; height: 420px; background: #fff0f5; border-bottom: 3px solid #fff; }
        .carousel { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; width: 100%; height: 100%; }
        .carousel img { min-width: 100%; height: 100%; object-fit: cover; scroll-snap-align: center; }

        /* --- DETAIL PAGE FLOATING HEART --- */
        /* Positioned "off the corner" as requested */
        .floating-heart-main {
            position: absolute; 
            bottom: 30px; right: 30px; /* Not touching the edge */
            width: 60px; height: 60px; 
            background-size: contain; background-repeat: no-repeat; background-position: center;
            filter: grayscale(100%) opacity(0.6) drop-shadow(0 5px 5px rgba(0,0,0,0.1)); 
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer; z-index: 20;
        }
        .floating-heart-main.active { filter: grayscale(0%) opacity(1); transform: scale(1.1) rotate(10deg); }

        .detail-section { padding: 25px; margin: 15px; background: rgba(255,255,255,0.6); border-radius: 20px; border: 2px solid #fff; }
        .title-row { display: flex; justify-content: space-between; align-items: start; }
        .detail-title { font-size: 22px; color: #d81b60; font-weight: 900; margin-bottom: 5px; flex-grow: 1; }
        .detail-meta { font-size: 13px; color: #9c27b0; margin-bottom: 10px; font-weight: bold; }
        .detail-price { font-size: 28px; font-weight: 900; color: #d81b60; }
        
        .buyer-protection {
            font-size: 13px; color: #d81b60; background: #fff0f5; border: 1px solid #ffb7c5;
            padding: 10px; border-radius: 12px; margin-top: 12px; display: inline-flex; align-items: center; gap: 8px; font-weight: bold;
        }

        .action-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; padding: 15px 20px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-top: 2px solid #ffb7c5; 
            display: flex; gap: 15px; z-index: 600; border-radius: 25px 25px 0 0;
        }
        
        .btn-cute {
            flex: 1; padding: 15px; border-radius: 30px; font-weight: 900; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; font-size: 16px;
            box-shadow: 0 5px 10px rgba(255, 105, 180, 0.3), inset 0 2px 0 rgba(255,255,255,0.5);
            border: 2px solid #fff; transition: transform 0.1s;
        }
        .btn-cute:active { transform: translateY(3px); box-shadow: 0 2px 5px rgba(255, 105, 180, 0.3); }
        .btn-offer { background: linear-gradient(to bottom, #fff0f5 0%, #ffc1e3 100%); color: #d81b60; }
        .btn-buy { background: linear-gradient(to bottom, #ff69b4 0%, #ff1493 100%); color: #fff; text-shadow: 0 2px 2px rgba(0,0,0,0.2); }

        .like-count-text { font-size: 14px; color: #d81b60; display: flex; align-items: center; gap: 6px; font-weight: bold; background: #fff; padding: 5px 10px; border-radius: 20px; }
        .like-count-text i { color: #ff1493; }

    </style>
</head>
<body>

    <div id="main-view">
        <nav class="top-bar">
            <div style="position:relative; flex-grow:1;">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" placeholder="Search cute items...">
            </div>
        </nav>

        <main class="product-grid" id="shop-container">
             <div style="padding:20px; grid-column:span 2; text-align:center; color:#d81b60; font-weight:bold;">Loading Shop... ✨</div>
        </main>

        <nav class="bottom-nav">
            <a href="#" class="nav-btn"><i class="fas fa-th-large"></i>More</a>
            <a href="#" class="nav-btn active"><i class="fas fa-shopping-bag"></i>Orders</a>
            <a href="#" class="nav-btn"><i class="fas fa-user-circle"></i>Profile</a>
        </nav>
    </div>

    <div id="product-page">
        <div class="app-header">
            <a href="#" onclick="closeProduct()" class="icon-btn"><i class="fas fa-arrow-left"></i></a>
            <a href="#" onclick="shareProduct()" class="icon-btn"><i class="fas fa-share-alt"></i></a>
        </div>

        <div class="image-container">
            <div class="carousel" id="detail-images"></div>
            <div class="floating-heart-main" id="like-trigger-main" onclick="toggleLikeFromDetail()"></div>
        </div>

        <div class="detail-section">
            <div class="title-row">
                <div class="detail-title" id="detail-name">Product Name</div>
                <div class="like-count-text">
                    <i class="fas fa-heart"></i>
                    <span id="like-counter">0</span>
                </div>
            </div>
            <div class="detail-meta" id="detail-meta">Brand • Category</div>
            <div class="detail-price" id="detail-price">$0.00</div>
            <div class="buyer-protection">
                <i class="fas fa-shield-alt" style="font-size:18px;"></i> Buyer Protection included
            </div>
        </div>

        <div class="detail-section">
            <p style="font-size:16px; line-height:1.6; color:#5d3a5d;" id="detail-desc">Description...</p>
        </div>

        <div class="action-bar">
            <button class="btn-cute btn-offer">Make offer</button>
            <button class="btn-cute btn-buy" onclick="alert('Opening checkout...')">Buy now</button>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQxSaXfeWcwBFpXFfbJ4lU25jKhR4ORNTbtQphKOUK7YL4JewJ2NzsS6UNf0V89UnzTufpcreBCJUJo/pub?output=csv";
        
        // Your Heart Link
        const heartImageUrl = "https://www.freepnglogos.com/uploads/heart-png/heart-icon-small-flat-4.png"; 
        
        // ==========================================
        
        let allProducts = [];
        const container = document.getElementById('shop-container');
        const mainView = document.getElementById('main-view');
        const productPage = document.getElementById('product-page');

        // Apply Heart Image to Detail Page
        const mainHeart = document.getElementById('like-trigger-main');
        if(heartImageUrl) mainHeart.style.backgroundImage = `url('${heartImageUrl}')`;

        async function loadProducts() {
            try {
                const response = await fetch(sheetUrl);
                const data = await response.text();
                allProducts = csvToJson(data);
                renderGrid(allProducts);
                checkHash();
            } catch (error) { console.error(error); }
        }

        // CSV Parser + Drive Link Fixer
        function csvToJson(csv) {
            const lines = csv.split('\n');
            const result = [];
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i]) continue;
                const row = lines[i].split(','); 
                
                const cleanImage = (url) => {
                    if (!url) return "";
                    let cleanUrl = url.trim();
                    if (cleanUrl.includes('drive.google.com')) {
                        const idMatch = cleanUrl.match(/[-\w]{25,}/);
                        if (idMatch) return `https://drive.google.com/thumbnail?id=${idMatch[0]}&sz=w1000`;
                    }
                    return cleanUrl;
                };

                result.push({
                    id: i,
                    name: row[0] || "Item",
                    price: (row[1] || "0").replace('$', '').trim(),
                    brand: row[2] || "Brand",
                    image: cleanImage(row[3]), 
                    category: row[4] || "Misc",
                    description: row[5] || "No description.",
                    moreImages: row[6] ? row[6].split(';').map(cleanImage) : [] 
                });
            }
            return result;
        }

        function renderGrid(products) {
            let html = '';
            products.forEach(p => {
                // Check if liked locally
                const isLiked = localStorage.getItem('liked_item_' + p.id);
                const activeClass = isLiked ? 'active' : '';

                html += `
                    <div class="product-card" onclick="openProduct(${p.id})">
                        <div class="card-heart ${activeClass}" id="card-heart-${p.id}" onclick="toggleLikeFromCard(event, ${p.id})"></div>
                        
                        <img src="${p.image}" class="product-image" onerror="this.src='https://via.placeholder.com/300/ffc1e3/d81b60?text=Cute+Item'">
                        <div class="product-info">
                            <div class="product-title">${p.name}</div>
                            <div class="brand">${p.brand}</div>
                            <div class="price">$${p.price}</div>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;

            // Apply background images to all mini hearts
            if(heartImageUrl) {
                document.querySelectorAll('.card-heart').forEach(el => {
                    el.style.backgroundImage = `url('${heartImageUrl}')`;
                });
            }
        }

        function openProduct(id) {
            const product = allProducts.find(p => p.id == id);
            if (!product) return;
            window.location.hash = `item-${id}`;
            document.getElementById('detail-name').innerText = product.name;
            document.getElementById('detail-price').innerText = '$' + product.price;
            document.getElementById('detail-desc').innerText = product.description;
            document.getElementById('detail-meta').innerText = `${product.brand} • ${product.category}`;

            let imagesHtml = `<img src="${product.image}">`;
            if (product.moreImages.length > 0) {
                product.moreImages.forEach(img => { if(img) imagesHtml += `<img src="${img}">`; });
            }
            document.getElementById('detail-images').innerHTML = imagesHtml;
            
            updateDetailLikeState(id);

            mainView.style.display = 'none';
            productPage.style.display = 'block';
            window.scrollTo(0,0);
        }

        function closeProduct() {
            window.location.hash = '';
            mainView.style.display = 'block';
            productPage.style.display = 'none';
            // Re-render grid to update hearts if they changed
            renderGrid(allProducts);
        }

        // --- LIKE LOGIC ---

        function updateDetailLikeState(id) {
            const btn = document.getElementById('like-trigger-main');
            const counter = document.getElementById('like-counter');
            const fakeGlobalLikes = Math.floor(id * 123 % 50) + 10;
            const isLiked = localStorage.getItem('liked_item_' + id);
            
            if(isLiked) {
                btn.classList.add('active');
                counter.innerText = fakeGlobalLikes + 1;
            } else {
                btn.classList.remove('active');
                counter.innerText = fakeGlobalLikes;
            }
        }

        function toggleLikeFromDetail() {
            const id = window.location.hash.replace('#item-','');
            const btn = document.getElementById('like-trigger-main');
            const isLiked = btn.classList.contains('active');
            
            if(isLiked) {
                btn.classList.remove('active');
                localStorage.removeItem('liked_item_' + id);
            } else {
                btn.classList.add('active');
                localStorage.setItem('liked_item_' + id, 'yes');
            }
            updateDetailLikeState(id);
        }

        function toggleLikeFromCard(event, id) {
            event.stopPropagation(); // Stop it from opening the product
            const heart = document.getElementById(`card-heart-${id}`);
            const isLiked = heart.classList.contains('active');

            if(isLiked) {
                heart.classList.remove('active');
                localStorage.removeItem('liked_item_' + id);
            } else {
                heart.classList.add('active');
                localStorage.setItem('liked_item_' + id, 'yes');
            }
        }

        // --- NAVIGATION ---
        function checkHash() {
            const hash = window.location.hash;
            if (hash.startsWith('#item-')) { openProduct(hash.replace('#item-', '')); } 
            else { closeProduct(); }
        }
        window.onhashchange = checkHash;

        loadProducts();
    </script>
</body>
</html>
